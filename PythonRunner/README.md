# CSharpPythonBridgePOC - Python Code #

This is a proof of concept of communicating between [C#.NET][2] and [Python 3.8][3] code by creating a DLL/DLLs that can then be called by Python code.

# What does it do? #

This is the Python script that consumes the Library code. Please see the main [README][1] for details.

# Concept #

Conceptually, the way the project works is it exposes C# static methods using the [Conari][4] and [DllExport][5] libraries which can be found on nuget. The exposure makes the functions and data types available to any language that can load C Dlls and call functions from those Dlls. Python, through it's [CTypes][6] library is able to do this. 

So conceptually, it works like this: 

> Python <-> (C/C++) <-> C#.NET. 

C/C++ is in parentheses because no direct C/C++ code need be written and at the time of this writing, there isn't any C/C++ code in the project. This same concept can eventually be used to wrap whole C#.NET libraries for use by CPython; potentially even GUI libraries like Windows Forms or WPF (Windows Presentation Foundation) without the need for [IronPython][7]. It may even facilitate the creation of a full blown Python GUI library for Windows. 

# Recommendation for Application #

In applying the principles that this demonstrates, I recommend writing a Python package that creates a "pythonic" interface for the functionality provided by the C# library. Then package the DLL generated by the C# project and call into the C# library from that pythonic interface. Then import the library into your actual running script or library and use it like you would any other python library.

I can potentially see some possible issues arising however. For whatever reason, I needed to wrap "result" in DialogResult()'s c-tor. I'm sure this can be mitigated using some type introspection in the pythonic interface library that would be written and the python library would just handle the typing correctly, but it is still not perfect as of yet. I will be continuing to experiment with this.

# Motivation for this #

I wanted to create a python script that allowed me to easily and in bulk fix missing and incorrect song information in the id3 tags of a massive music library on my phone which I sometimes use as an MP3 player. The problem is that when you connect your phone to a windows computer, it doesn't mount the device as a drive in Windows such that you can directly access it via a path. Instead, you have to use the [Media Transfer Protocol (MTP)][8] to communicate with the device. Annoying but whatever. 

The problem is that I wasn't finding any libraries for MTP on Windows specifically for Python. I could find one in nuget for C# that is fairly good and well documented, but not one for Python. I wanted to use the C# library but how do you do that from Python? I thought about using [IronPython][7] but it seems not to have been updated for a long time. 

This led me to ask if C# libraries can be exposed for use by C since Python can use C libraries using the CTypes standard lib. It was then that I found [Conari][4] and [DllExport][5]. From there I worked on creating this proof of concept just to see if it would work to allow Python to call C# code and pass data back and forth and it does. By expanding this proof of concept, I will be able to demonstrate and prototype the techniques I intend to use to write a wrapper for this library in Python and C#. 

# Special Thanks #

Special thanks to @reflectronic on the C# discord for helping me with the marshaling of strings in C#. 

[1]: <https://github.com/GinoMan/CSharpPythonBridgePOC#CSharpPythonBridgePOC> (Main Project README)
[2]: <https://docs.microsoft.com/en-us/dotnet/csharp/> (C# Programming Language for the .NET Platform)
[3]: <https://www.python.org/> (Python Programming Language - 2.8)
[4]: <https://github.com/3F/Conari> (Conari Project Github Link)
[5]: <https://github.com/3F/DllExport> (DllExport Project Github Link)
[6]: <https://docs.python.org/3/library/ctypes.html> (Python CTypes Foreign Function Interface Library Documentation)
[7]: <https://ironpython.net/> (IronPython Official Website - Python for .NET CLR)
[8]: <https://en.wikipedia.org/wiki/Media_Transfer_Protocol> (Wikipedia Page for Media Transfer Protocol)